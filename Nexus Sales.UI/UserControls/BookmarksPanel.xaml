<UserControl x:Class="NexusSales.UI.UserControls.BookmarksPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:NexusSales.UI.UserControls"
             xmlns:conv="clr-namespace:NexusSales.UI.Converters"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:NexusSales.UI.ViewModels"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Background="Transparent"
             IsVisibleChanged="UserControl_IsVisibleChanged">
    <UserControl.Resources>
        <conv:ZeroToVisibilityConverter x:Key="ZeroToVisibilityConverter"/>
        <Storyboard x:Key="ShowPanelStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.4"/>
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" From="0.95" To="1" Duration="0:0:0.4"/>
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" From="0.95" To="1" Duration="0:0:0.4"/>
        </Storyboard>
        <Storyboard x:Key="HidePanelStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.25"/>
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" To="0.95" Duration="0:0:0.25"/>
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" To="0.95" Duration="0:0:0.25"/>
        </Storyboard>
        <Storyboard x:Key="RemoveBookmarkStoryboard">
            <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.3"/>
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)" To="100" Duration="0:0:0.2"/>
        </Storyboard>
    </UserControl.Resources>
    <Border CornerRadius="24"
            Background="{StaticResource BackgroundBrush}"
            Padding="18"
            Opacity="1"
            Width="350"
            Height="300"
            BorderThickness="1"
            BorderBrush="{StaticResource AccentBrush}"
            RenderTransformOrigin="0.5,0.5">
        <Border.RenderTransform>
            <ScaleTransform ScaleX="1" ScaleY="1"/>
        </Border.RenderTransform>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid Grid.Row="0">
                <TextBlock Text="Bookmarked"
                           FontSize="22"
                           FontWeight="Bold"
                           Foreground="#FFD700"
                           Margin="0,0,0,18"
                           HorizontalAlignment="Center"/>
            </Grid>
            <ListView Grid.Row="1"
                      ItemsSource="{Binding UserBookmarks}"
                      Background="{StaticResource BackgroundBrush}"
                      BorderThickness="0"
                      ScrollViewer.VerticalScrollBarVisibility="Auto"
                      ScrollViewer.CanContentScroll="True">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListViewItem">
                                    <ContentPresenter/>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="Transparent"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="Transparent"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </ListView.ItemContainerStyle>
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,0,0,12"
                                Padding="12"
                                CornerRadius="12"
                                Background="{StaticResource BackgroundLiteBrush}"
                                Effect="{StaticResource DropShadowEffect}"
                                Width="290">
                            <Border.RenderTransform>
                                <TranslateTransform X="0"/>
                            </Border.RenderTransform>
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsRemoving}" Value="True">
                                            <DataTrigger.EnterActions>
                                                <BeginStoryboard Storyboard="{StaticResource RemoveBookmarkStoryboard}"/>
                                            </DataTrigger.EnterActions>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Grid Grid.Column="0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <TextBlock Grid.Row="0" Text="{Binding Title}" TextWrapping="Wrap" FontWeight="Bold" FontSize="16" Foreground="{StaticResource FontNormalBrush}" Width="240"/>
                                    <TextBlock Grid.Row="1" Text="{Binding Message}" TextWrapping="Wrap" Foreground="{StaticResource FontDarkBrush}" Margin="0,4,0,0" Width="240"/>
                                    <TextBlock Grid.Row="2" Text="{Binding Timestamp, StringFormat='{}{0:MMM dd, yyyy hh:mm tt}'}" FontSize="11" Foreground="{StaticResource FontDarkBrush}" Margin="0,2,0,0" Width="240"/>
                                </Grid>
                                <Button Grid.Column="1"
                                        Width="32" Height="32"
                                        Margin="8,0,0,0"
                                        ToolTip="Remove from Bookmarks"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Command="{Binding DataContext.UnpinNotificationCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}">
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{x:Null}">
                                            <Setter Property="Cursor" Value="Hand"/>
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="BorderBrush" Value="Transparent"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="OverridesDefaultStyle" Value="True"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Button.Style>
                                    <iconPacks:PackIconMaterial Kind="BookmarkRemove" Width="18" Height="18" Foreground="#FFD700"/>
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
                <ListView.Style>
                    <Style TargetType="ListView">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding UserBookmarks.Count}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ListView.Style>
            </ListView>
            <StackPanel Grid.Row="2" Visibility="{Binding UserBookmarks.Count, Converter={StaticResource ZeroToVisibilityConverter}}" Margin="0 0 0 110">
                <TextBlock Text="No bookmarks yet." Foreground="{StaticResource FontDarkBrush}" FontSize="16" HorizontalAlignment="Center" Margin="0,40,0,0"/>
                <iconPacks:PackIconMaterial Kind="BookmarkOutline" Width="48" Height="48" Foreground="#FFD700" HorizontalAlignment="Center" Margin="0,12,0,0"/>
            </StackPanel>
        </Grid>
    </Border>
    <UserControl.Triggers>
        <EventTrigger RoutedEvent="UserControl.Loaded">
            <BeginStoryboard Storyboard="{StaticResource ShowPanelStoryboard}"/>
        </EventTrigger>
    </UserControl.Triggers>
</UserControl>